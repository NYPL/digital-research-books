name: Full CI/CD Pipeline

on:
  push:
    branches: [main]

jobs:
  deploy_to_qa:
    uses: NYPL/drb-etl-pipeline/.github/workflows/deploy.yml@main
    secrets: inherit

  run_api_tests:
    needs: deploy_to_qa
    uses: NYPL/drb-etl-pipeline/.github/workflows/ci.yaml@main
    secrets: inherit

  deploy_to_production:
    needs: run_api_tests
    uses: NYPL/drb-etl-pipeline/.github/workflows/build-production.yaml@main
    secrets: inherit
